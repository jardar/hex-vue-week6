import{_ as T,a as u,h as _,r as p,o as d,c as r,b as n,d as e,F as A,e as I,t as i,w as S,g as b,f as v,n as g,i as O,v as U}from"./index-4b7bad84.js";const{VITE_NAME:x,VITE_EMAIL:C}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"jardar",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0},{VITE_TEL:V,VITE_ADDR:E,VITE_NOTE:L}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"jardar",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0},w={data(){return{isLoading:"",isDelLoading:"",cart:{carts:[]},order:{name:x,email:C,tel:V,addr:E,note:L}}},methods:{clearOrderInfo(){this.order={name:x,email:C,tel:V,addr:E,note:L}},onSubmit(a){console.log("onSubmit:",a),console.log(`onSubmit:${this.order}`),this.isLoading=!0,u.post(_.epCreateOrder,{data:{user:{name:this.order.name,email:this.order.email,tel:this.order.tel,address:this.order.addr},message:this.order.note}}).then(s=>{console.log(s.data.data),alert("結帳成功"),this.doGetCart()}).catch(s=>{alert(`失敗:${s.response.data.message||"error"}`)}).finally(()=>{this.isLoading=!1})},handleQtyChange(a,s,f){const y=this.cart.carts.find(t=>t.id===a);y.qty=f,this.isLoading=!0,u.put(_.epUpdateCart(a),{data:{product_id:s,qty:parseInt(f)}}).then(t=>{console.log(t.data.data),alert("數量更改成功"),this.doGetCart()}).catch(t=>{alert(`失敗:${t.response.data.message||"error"}`)}).finally(()=>{this.isLoading=!1})},handleDelCart(a){this.isDelLoading=a,u.delete(_.epDeleteACart(a)).then(s=>{console.log(s.data),alert(s.data.message),this.doGetCart()}).catch(s=>{alert(`失敗:${s.response.data.message||"error"}`)}).finally(()=>{this.isDelLoading=""})},handleClearAllCart(){this.isLoading=!0,u.delete(_.epDeleteCarts).then(a=>(this.cart=[],alert(a.data.message),this.doGetCart())).catch(a=>{alert(`失敗:${a.response.data.message||"error"}`)}).finally(()=>{this.isLoading=!1})},doGetCart(){this.isLoading=!0,u.get(_.epGetCarts).then(a=>{this.cart=a.data.data}).catch(a=>{alert(`失敗:${a.response.data.message||"error"}`)}).finally(()=>{this.isLoading=!1})}},mounted(){this.doGetCart()}},B={class:"container"},G={class:"mt-4"},N={class:"text-end"},P={class:"table align-middle"},q=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",null,"單價"),e("th",null,"小計")])],-1),M=["onClick","disabled"],R={key:0,class:"fas fa-spinner fa-pulse"},j={key:0,class:"text-success"},F={class:"input-group input-group-sm"},H={class:"input-group mb-3"},Q=["value","onBlur"],z={class:"input-group-text",id:"basic-addon2"},J={class:"text-end"},K={class:"text-end"},W={key:0,class:"text-success"},X={key:1},Y=e("td",{colspan:"5"},[e("p",{style:{"text-align":"center",padding:"30px"}},"購物車為空")],-1),Z=[Y],$=e("td",{colspan:"4",class:"text-end"},"總計",-1),ee={class:"text-end"},te=e("td",{colspan:"4",class:"text-end text-success"},"折扣價",-1),se={class:"text-end text-success"},le={class:"my-5 row justify-content-center"},ae={class:"mb-3"},oe=e("label",{for:"email",class:"form-label"},"Email",-1),ne={class:"mb-3"},de=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),re={class:"mb-3"},ie=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),ce={class:"mb-3"},ue=e("label",{for:"address",class:"form-label"},"收件人地址",-1),_e={class:"mb-3"},me=e("label",{for:"message",class:"form-label"},"留言",-1),he={class:"text-end"},pe=["disabled"];function ge(a,s,f,y,t,c){const D=p("my-loading"),m=p("v-field"),h=p("error-message"),k=p("v-form");return d(),r("div",B,[n(D,{active:t.isLoading},null,8,["active"]),e("div",G,[e("div",N,[e("button",{class:"btn btn-outline-danger",type:"button",onClick:s[0]||(s[0]=(...l)=>c.handleClearAllCart&&c.handleClearAllCart(...l))}," 清空購物車 ")]),e("table",P,[q,e("tbody",null,[t.cart.carts&&t.cart.carts.length>0?(d(!0),r(A,{key:0},I(t.cart.carts,l=>(d(),r("tr",{key:l.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:o=>c.handleDelCart(l.id),disabled:t.isDelLoading===l.id},[t.isDelLoading===l.id?(d(),r("i",R)):b("",!0),v(" x ")],8,M)]),e("td",null,[v(i(l.product.title)+" ",1),l.product.origin_price>l.product.price?(d(),r("div",j," 已套用優惠券 ")):b("",!0)]),e("td",null,[e("div",F,[e("div",H,[e("input",{min:"1",type:"number",class:"form-control",value:l.qty,onBlur:o=>c.handleQtyChange(l.id,l.product_id,o.target.value)},null,40,Q),e("span",z,i(l.product.unit),1)])])]),e("td",J,i(l.product.price),1),e("td",K,[l.product.origin_price>l.product.price?(d(),r("small",W,"折扣價：")):b("",!0),v(" "+i(l.total),1)])]))),128)):(d(),r("tr",X,Z))]),e("tfoot",null,[e("tr",null,[$,e("td",ee,i(t.cart.total),1)]),e("tr",null,[te,e("td",se,i(t.cart.final_total),1)])])])]),e("div",le,[n(k,{ref:"form",class:"col-md-6",onSubmit:c.onSubmit},{default:S(({errors:l})=>[e("div",ae,[oe,n(m,{id:"email",name:"email",type:"email",modelValue:t.order.email,"onUpdate:modelValue":s[1]||(s[1]=o=>t.order.email=o),class:g(["form-control",{"is-invalid":l.email}]),placeholder:"請輸入 Email",rules:"required|email"},null,8,["modelValue","class"]),n(h,{name:"email",class:"invalid-feedback"})]),e("div",ne,[de,n(m,{id:"name",name:"姓名",type:"text",modelValue:t.order.name,"onUpdate:modelValue":s[2]||(s[2]=o=>t.order.name=o),class:g(["form-control",{"is-invalid":l.姓名}]),placeholder:"請輸入姓名",rules:"required"},null,8,["modelValue","class"]),n(h,{name:"姓名",class:"invalid-feedback"})]),e("div",re,[ie,n(m,{id:"tel",name:"電話",type:"tel",modelValue:t.order.tel,"onUpdate:modelValue":s[3]||(s[3]=o=>t.order.tel=o),class:g(["form-control",{"is-invalid":l.電話}]),placeholder:"請輸入電話",rules:"cellphone"},null,8,["modelValue","class"]),n(h,{name:"電話",class:"invalid-feedback"})]),e("div",ce,[ue,n(m,{id:"address",name:"地址",type:"text",modelValue:t.order.addr,"onUpdate:modelValue":s[4]||(s[4]=o=>t.order.addr=o),class:g(["form-control",{"is-invalid":l.地址}]),placeholder:"請輸入地址",rules:"required"},null,8,["modelValue","class"]),n(h,{name:"地址",class:"invalid-feedback"})]),e("div",_e,[me,O(e("textarea",{id:"message","onUpdate:modelValue":s[5]||(s[5]=o=>t.order.note=o),class:"form-control",cols:"30",rows:"10"},null,512),[[U,t.order.note]])]),e("div",he,[e("button",{type:"submit",class:"btn btn-danger",disabled:Object.keys(l).length>0}," 送出訂單 ",8,pe)])]),_:1},8,["onSubmit"])])])}const be=T(w,[["render",ge]]);export{be as default};
